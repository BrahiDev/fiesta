(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class l extends Phaser.Scene{constructor(){super("MenuPrincipal")}preload(){this.load.image("fondoMenu","assets/fondo iglu 2.jpg"),this.load.image("titulo","assets/TITULO-JUEGO.png"),this.load.image("Personaje","assets/Player.png"),this.load.image("botonJugar","assets/boton_jugar.png")}create(){const t=this.cameras.main.width,e=this.cameras.main.height,a=this.add.image(t/2,e/2,"fondoMenu"),s=t/a.width,i=e/a.height,r=Math.max(s,i);a.setScale(r).setDepth(-1),this.add.image(this.cameras.main.centerX,150,"titulo").setScale(.8),this.add.image(this.cameras.main.centerX,400,"Personaje").setScale(.3).setInteractive(),this.add.image(this.cameras.main.centerX,500,"botonJugar").setScale(.3).setInteractive().on("pointerdown",()=>{this.scene.start("MainScene")}),this.add.text(this.cameras.main.centerX,e-50,"Toca para Empezar",{fontFamily:"Arial",fontSize:32,color:"#000000"}).setOrigin(.5)}update(){}}class c extends Phaser.Scene{constructor(){super("Winner")}preload(){this.load.image("WinnerBackground","assets/fondo iglu 2.jpg"),this.load.image("titulo_Winner","assets/YOU_WIN.png"),this.load.image("Personaje_Winner","assets/personaje_winner.png"),this.load.image("botonMenu","assets/boton_regreso.png"),this.load.audio("victoria","assets/victoria.mp3")}create(){const t=this.cameras.main.width,e=this.cameras.main.height;this.textures.exists("WinnerBackground")?this.add.image(t/2,e/2,"WinnerBackground").setScale(Math.max(t/this.textures.get("WinnerBackground").getSourceImage().width,e/this.textures.get("WinnerBackground").getSourceImage().height)).setDepth(-1):this.cameras.main.setBackgroundColor("#000"),this.add.image(t/2+30,150,"titulo_Winner").setScale(.8);const i=(150+(e/2+180))/2;this.add.image(t/2,i,"Personaje_Winner").setScale(.7);const r=e/2+150;this.add.text(t/2,r,"Volver al Menú",{fontFamily:"Arial",fontSize:32,color:"#000000",align:"center"}).setOrigin(.5);const n=e/2+210;this.add.image(t/2,n,"botonMenu").setScale(.1).setInteractive().on("pointerdown",()=>{this.scene.start("MenuPrincipal")}),this.sound.play("victoria")}update(){}}class h extends Phaser.Scene{constructor(){super("GameOver")}preload(){this.load.image("gameOverBackground","assets/sky_game_over.PNG"),this.load.image("titulo_game_over","assets/GAME_OVER.png"),this.load.image("Personaje_game_over","assets/dead_game_over.png"),this.load.image("botonMenu","assets/boton_regreso.png"),this.load.audio("derrota","assets/derrota.wav")}create(){const t=this.cameras.main.width,e=this.cameras.main.height;this.textures.exists("gameOverBackground")?this.add.image(t/2,e/2,"gameOverBackground").setScale(Math.max(t/this.textures.get("gameOverBackground").getSourceImage().width,e/this.textures.get("gameOverBackground").getSourceImage().height)).setDepth(-1):this.cameras.main.setBackgroundColor("#000"),this.add.image(this.cameras.main.centerX,150,"titulo_game_over").setScale(.8),this.add.image(t/2+50,e/3,"Personaje_game_over").setScale(.7),this.add.text(t/2,e/2+120,"Volver al Menú",{fontFamily:"Arial",fontSize:32,color:"#000000",align:"center"}).setOrigin(.5),this.add.image(t/2,e/2+180,"botonMenu").setScale(.1).setInteractive().on("pointerdown",()=>{this.scene.start("MenuPrincipal")}),this.sound.play("derrota")}update(){}}class d extends Phaser.Scene{constructor(){super("MainScene"),this.player=null,this.cursors=null,this.background=null,this.señales=[],this.taskResults=[null,null,null],this.chulitos=[],this.cruces=[],this.taskCounterText=null,this.localStorageCheckInterval=1e3,this.localStorageTimer=null,this.gameOverTriggered=!1}preload(){this.load.image("player","assets/player.png"),this.load.image("background","assets/sky.png"),this.load.image("senal","assets/point.png"),this.load.image("chulito_verde","assets/chulito_verde.png"),this.load.image("chulito_rojo","assets/chulito_rojo.png"),this.load.image("cruz_roja","assets/cruz_roja.png"),this.load.audio("tarea_completada","assets/tarea_completada.mp3")}create(){this.background=this.add.image(400,300,"background").setDisplaySize(800,600),this.player=this.physics.add.image(100,100,"player").setOrigin(.5,.5).setDisplaySize(50,50).setDepth(2),this.cursors=this.input.keyboard.createCursorKeys(),this.señales.push(this.physics.add.image(200,200,"senal").setOrigin(.5,.5).setDepth(1).setName("senal1").setInteractive()),this.señales.push(this.physics.add.image(400,400,"senal").setOrigin(.5,.5).setDepth(1).setName("senal2").setInteractive()),this.señales.push(this.physics.add.image(600,300,"senal").setOrigin(.5,.5).setDepth(1).setName("senal3").setInteractive()),this.señales.forEach((e,a)=>{e.taskId=a,this.cruces[a]=this.add.sprite(e.x,e.y-e.height/2-10,"cruz_roja").setScale(.1).setOrigin(.5,0).setVisible(!1)}),this.displayTaskResults(),this.updateTaskCounter(),this.taskCounterText=this.add.text(20,20,"Tareas: 0/3",{fontFamily:"Arial",fontSize:24,color:"#000"}).setDepth(100);const t=document.getElementById("taskCounter");t&&(t.style.display="none"),this.localStorageTimer=this.time.addEvent({delay:this.localStorageCheckInterval,callback:this.checkLocalStorage,callbackScope:this,loop:!0}),this.checkGameOver()}checkLocalStorage(){const t=localStorage.getItem("pesca_result");if(t){const s=JSON.parse(t);this.handleTaskResult(s.completedTask,s.result),localStorage.removeItem("pesca_result")}const e=localStorage.getItem("objetos_result");if(e){const s=JSON.parse(e);this.handleTaskResult(s.completedTask,s.result),localStorage.removeItem("objetos_result")}const a=localStorage.getItem("globos_result");if(a){const s=JSON.parse(a);this.handleTaskResult(s.completedTask,s.result),localStorage.removeItem("globos_result")}}handleTaskResult(t,e){this.taskResults[t]===null&&(this.taskResults[t]=e,this.displayTaskResult(t,e),this.señales[t].removeInteractive(),this.updateTaskCounter(),this.checkWinner(),e==="ganado"&&this.sound.play("tarea_completada"),this.checkGameOver())}displayTaskResult(t,e){if(this.señales[t]){const a=e==="ganado"?"chulito_verde":"chulito_rojo",s=e==="perdido",i=e==="ganado";this.textures.exists(a)?this.chulitos[t]?this.chulitos[t].setTexture(a).setVisible(i):this.chulitos[t]=this.add.sprite(this.señales[t].x,this.señales[t].y-this.señales[t].height/2-10,a).setScale(.1).setOrigin(.5,0).setVisible(i):console.warn(`La textura ${a} NO está cargada.`),this.cruces[t]?this.cruces[t].setVisible(s):this.cruces[t]=this.add.sprite(this.señales[t].x,this.señales[t].y-this.señales[t].height/2-10,"cruz_roja").setScale(.1).setOrigin(.5,0).setVisible(s)}}displayTaskResults(){this.taskResults.forEach((t,e)=>{t&&(this.displayTaskResult(e,t),this.señales[e]&&this.señales[e].removeInteractive())}),this.checkGameOver()}updateTaskCounter(){const e=`Tareas: ${this.taskResults.filter(a=>a!==null).length}/3`;this.taskCounterText&&this.taskCounterText.setText(e)}update(){this.gameOverTriggered||(this.cursors.left.isDown&&this.player.x>0?this.player.x-=5:this.cursors.right.isDown&&this.player.x<800&&(this.player.x+=5),this.cursors.up.isDown&&this.player.y>0?this.player.y-=5:this.cursors.down.isDown&&this.player.y<600&&(this.player.y+=5),this.señales.forEach(e=>{Phaser.Math.Distance.Between(this.player.x,this.player.y,e.x,e.y)<30&&e.input&&this.taskResults[e.taskId]===null&&(console.log(`Jugador cerca de ${e.name} (taskId: ${e.taskId})!`),this.abrirMinijuego(e.taskId))}))}abrirMinijuego(t){if(!this.gameOverTriggered){let e="";switch(t){case 0:e="pesca.html";break;case 1:e="objetos.html";break;case 2:e="globos.html";break;default:console.log(`taskId desconocido para abrir minijuego: ${t}`);return}window.open(e,"_blank")}}checkWinner(){console.log("Estado de taskResults:",this.taskResults),this.taskResults.every(e=>e==="ganado")&&!this.winnerTriggered&&(console.log("¡Todas las tareas ganadas! Iniciando Winner..."),this.winnerTriggered=!0,this.scene.start("Winner"),this.localStorageTimer.destroy())}checkGameOver(){this.taskResults.some(e=>e==="perdido")&&!this.gameOverTriggered&&(this.gameOverTriggered=!0,this.scene.start("GameOver"))}}const u={type:Phaser.AUTO,width:800,height:600,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[l,d,c,h]};new Phaser.Game(u);
